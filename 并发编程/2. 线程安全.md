# 1. 线程安全
标签（空格分隔）： 并发编程
---
## 线程安全概念
当多个线程访问某一个类（对象或方法）时，这个类始终都能表现出正确的行为，那么这个类（对象或方法）就是线程安全的。

在同一程序中运行多个线程本身不会导致问题，问题在于多个线程访问了相同的资源。实际上，这些问题只有在一或多个线程向这些资源做了写操作时才有可能发生，只要资源没有发生变化，多个线程读取相同的资源就是安全的。
竞态条件： 当两个线程竞争同一资源时，如果对资源的访问顺序敏感，就称存在竞态条件。导致竞态条件发生的代码区称作临界区。
下面的代码中，若多个线程执行add()就会存在竞态条件，临界区就是add()方法。
```
public class Counter {
    protected long count = 0;
    public void add(long value){
        this.count = this.count + value;  
    }
}
```
在 Java 中若发生竞态条件，实现线程安全需要满足2个特性：
1. 原子性：操作不可拆分。
2. 可见性：线程间能及时的看见资源的改变。因为当线程获取资源时，会复制一份资源到CPU的高速缓存区（L1、L2 cache 等），且线程间是不可见的，若更新资源后只是保存在CPU的高速缓存区中，其它线程获取的资源仍将会是原有的值，所以需要将更新后值刷会主缓存区，并通知其它线程重新刷新资源。


